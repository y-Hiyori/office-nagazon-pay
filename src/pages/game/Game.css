/* src/pages/game/Game.css */

/* =========================
   Game.css (NAGAZON Pay style / refined)
   ✅ 上下のカード幅ライン統一
   ✅ スマホ最適化：min-width:0 / wrap / overflow safety
   ✅ overlayCard の 100vw 依存をやめる（これがはみ出し原因）
   ✅ 説明画像枠：どの幅でも絶対はみ出さない auto grid
   ✅ canvas高さはJS制御
========================= */

:root{
  --g-bg:#0b0f19;
  --g-card2: rgba(15,18,30,0.92);

  --g-shadow: 0 18px 60px rgba(0,0,0,0.38);
  --g-shadow2: 0 12px 32px rgba(0,0,0,0.30);

  --g-radius2: 20px;

  /* ✅ “安全余白” + iPhone safe-area 対応 */
  --g-safe-x-base: clamp(10px, 2.6vw, 18px);
  --g-safe-x: calc(var(--g-safe-x-base) + env(safe-area-inset-left, 0px) + env(safe-area-inset-right, 0px));
}

.gamePage{
  min-height: 100svh;
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: 100%;
  overflow-x: hidden; /* clipより確実に止まる端末がある */
}
.gamePage, .gamePage *{ box-sizing: border-box; }

html, body{
  overscroll-behavior: none;
  overflow-x: hidden;
}

/* =========================
   Layout
========================= */

.gameMain{
  flex: 1;
  display: block;
  padding: 14px 0 18px;
}

.gameWrap{
  width: min(980px, 100%);
  margin: 0 auto;
  padding-inline: var(--g-safe-x-base); /* ここはbaseのみ（safe-areaはbody側で効く） */
  max-width: 100%;
  min-width: 0;
}

/* =========================
   Canvas shell
========================= */

.canvasShell{
  position: relative;
  width: 100%;
  max-width: 100%;
  min-width: 0;

  border-radius: var(--g-radius2);
  overflow: hidden;

  background:
    radial-gradient(1200px 600px at 40% 0%,
      rgba(255,255,255,0.07),
      rgba(255,255,255,0.00) 60%),
    radial-gradient(900px 500px at 90% 40%,
      rgba(90,120,255,0.10),
      rgba(0,0,0,0.00) 65%),
    var(--g-bg);

  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: var(--g-shadow);
}

.gameCanvas{
  display:block;
  width:100%;
  max-width:100%;
  height:auto; /* JS制御 */
  touch-action:none;
  user-select:none;
  -webkit-user-select:none;
}

/* =========================
   HUD
========================= */

.hudBar{
  position:absolute;
  top:12px;
  left:12px;
  right:12px;

  display:flex;
  gap:10px;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;

  padding:10px 12px;
  border-radius:16px;

  background: rgba(255,255,255,0.09);
  border: 1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(14px);

  z-index:3;
  color:#fff;
  font-weight:900;
  letter-spacing:0.02em;

  min-width: 0;
}
.hudItem{
  opacity:.95;
  white-space:nowrap;
  min-width: 0;
}

/* =========================
   Overlay
   ✅ overlayCard は 100vw を使わない（はみ出し防止）
========================= */

.overlay{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;

  padding:14px;
  background: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.18), rgba(0,0,0,0.58));
  overflow:hidden;
  z-index:5;

  min-width: 0;
}

.overlayCard{
  /* ✅ overlay の padding 内で完結させる（100%基準） */
  width: min(760px, 100%);
  max-width: 100%;
  min-width: 0;

  max-height: min(76svh, 640px);
  overflow:auto;
  -webkit-overflow-scrolling: touch;

  border-radius: 20px;
  border: 1px solid rgba(255,255,255,0.16);
  background:
    radial-gradient(800px 400px at 30% 0%, rgba(255,255,255,0.07), rgba(0,0,0,0) 65%),
    rgba(12,16,28,0.94);

  color:#fff;
  padding:16px;
  box-shadow: 0 22px 70px rgba(0,0,0,0.55);
}

.overlayTitle{
  font-weight:950;
  font-size:22px;
  margin-bottom:10px;
  text-align:center;
}

.overlayText{
  font-weight:800;
  font-size:15px;
  line-height:1.6;
  opacity:.96;
  margin-bottom:12px;
  word-break: break-word;
}
.overlayText.center{ text-align:center; }

.overlayText.quizQuestion{
  font-size: clamp(16px, 2.2vw, 22px);
  line-height: 1.75;
  letter-spacing: .02em;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.12);
}

.overlayRow{
  display:flex;
  gap:10px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:12px;
  min-width: 0;
}

.overlayHint{
  margin-top:10px;
  font-size:12px;
  opacity:.75;
  text-align:center;
}

/* Buttons */
.overlayPrimary{
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.10);
  color:#fff;
  font-weight:950;
  cursor:pointer;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}
.overlayPrimary:hover{
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.26);
  transform: translateY(-1px);
}
.overlayPrimary:active{ transform: translateY(0); }
.overlayPrimary.ghost{ background: rgba(255,255,255,0.06); }

.diffBtn{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  font-weight:950;
  cursor:pointer;
  min-width:92px;
  max-width:44vw;
  text-align:center;
  white-space:nowrap;
}
.diffBtn.on{
  border-color: rgba(255,255,255,0.28);
  background: rgba(255,255,255,0.14);
}

/* Start overlay layout */
.gStartGrid{
  display:grid;
  grid-template-columns: 1fr 330px;
  gap:14px;
  align-items:stretch;
  min-width: 0;
}
.gStartLeft, .gStartRight{ min-width:0; }
@media (max-width: 860px){
  .gStartGrid{ grid-template-columns: 1fr; }
}

/* =========================
   Below sections
========================= */

.gBelow{
  width:100%;
  margin:16px auto 64px;
  display:grid;
  gap:14px;
  min-width: 0;
}

.gSectionCard{
  border-radius: var(--g-radius2);
  padding:18px 16px;
  background:
    radial-gradient(900px 400px at 30% 0%, rgba(255,255,255,0.06), rgba(0,0,0,0) 65%),
    var(--g-card2);
  border:1px solid rgba(255,255,255,0.08);
  box-shadow: var(--g-shadow);
  color:#fff;

  /* ✅ はみ出し事故を止める */
  overflow: hidden;
  min-width: 0;
}

.gSectionHead{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
  padding-bottom:10px;
  border-bottom:1px solid rgba(255,255,255,0.08);
  margin-bottom:12px;
  flex-wrap: wrap;
  min-width: 0;
}

.gSectionTitle{
  font-size:18px;
  font-weight:950;
  letter-spacing:.02em;
  min-width: 0;
}

.gSectionSub{
  font-size:12px;
  opacity:.74;
  white-space: normal;
  line-height:1.4;
  text-align:right;
  max-width:100%;
  word-break: break-word;
  min-width: 0;
}

.gSectionInfo{
  opacity:.82;
  font-size:13px;
  font-weight:800;
}
.gSectionErr{
  color:#ff7b7b;
  font-weight:900;
  font-size:13px;
}
.gSectionNote{
  margin-top:10px;
  font-size:12px;
  opacity:.70;
  word-break: break-word;
}

/* Rewards */
.gRewardList{
  margin:0;
  padding-left:18px;
  display:grid;
  gap:10px;
  min-width: 0;
}
.gRewardList li{ line-height:1.55; }
.gRewardList .badge{
  display:inline-block;
  margin-right:8px;
  padding:3px 10px;
  border-radius:999px;
  font-size:11px;
  font-weight:950;
  background: rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.10);
}
.gRewardDesc{
  margin-top:4px;
  font-size:12px;
  opacity:.72;
  word-break: break-word;
}

/* Howto */
.gHowto{
  display:grid;
  gap:10px;
  min-width: 0;
}
.gHowto .step{
  display:grid;
  grid-template-columns: 34px 1fr;
  gap:12px;
  align-items:center;
  padding:12px 14px;
  border-radius:18px;
  background: rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.09);
  min-width: 0;
}
.gHowto .n{
  width:34px;
  height:34px;
  border-radius:12px;
  display:grid;
  place-items:center;
  font-weight:950;
  background: rgba(167,199,255,0.20);
  border:1px solid rgba(255,255,255,0.10);
}
.gHowto .t{
  font-size:13px;
  font-weight:850;
  opacity:.92;
  min-width:0;
  word-break: break-word;
}

/* ✅ “説明画像枠” = どの幅でも絶対はみ出さない */
.gHowtoImgs{
  margin-top:12px;
  display:grid;
  gap:10px;

  /* ✅ 220pxが強すぎたので、もっと柔らかく＆確実に折り返す */
  grid-template-columns: repeat(auto-fit, minmax(min(180px, 100%), 1fr));

  width: 100%;
  max-width: 100%;
  min-width: 0;
}
.gHowtoImgs > *{ min-width:0; }

.gHowtoImgPh{
  min-height:150px;
  border-radius:18px;
  border:1px dashed rgba(255,255,255,0.20);
  background: rgba(255,255,255,0.03);
  display:grid;
  place-items:center;
  text-align:center;
  padding:14px;
  opacity:.85;
  font-size:13px;
  font-weight:850;

  word-break: break-word;
  max-width: 100%;
  min-width: 0;
}

/* Rank top50 */
.gRank50Wrap{
  width:100%;
  overflow:auto;
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.02);
  min-width: 0;
}
.gRank50Table{
  width:100%;
  border-collapse:collapse;
  min-width:560px; /* 横スクロール前提 */
}
.gRank50Table th, .gRank50Table td{
  padding:11px 12px;
  border-bottom:1px solid rgba(255,255,255,0.06);
  font-size:13px;
}
.gRank50Table th{
  text-align:left;
  opacity:.75;
  font-weight:950;
  white-space:nowrap;
}
.gRank50Table tbody tr:hover td{ background: rgba(255,255,255,0.04); }
.gRank50Table td.num{ width:60px; font-weight:950; color: rgba(255,255,255,0.75); }
.gRank50Table td.score{ text-align:right; font-weight:950; letter-spacing:.02em; }
.gRank50Table td.diff{ width:90px; opacity:.88; font-weight:900; }

/* =========================
   Mobile tuning
========================= */

@media (max-width: 520px){
  .gameMain{ padding:10px 0 16px; }

  .hudBar{
    top:10px; left:10px; right:10px;
    padding:9px 10px;
    gap:8px;
    border-radius:14px;
  }
  .hudItem{ font-size:12px; }

  .overlay{ padding:10px; }
  .overlayCard{ padding:14px; border-radius:18px; }
  .overlayTitle{ font-size:20px; }

  .diffBtn{ min-width:86px; padding:10px 12px; max-width:46vw; }

  .gSectionCard{ padding:16px 14px; border-radius:18px; }
  .gSectionHead{ align-items:flex-start; }
  .gSectionSub{ text-align:left; }
}

button:focus-visible{
  outline:2px solid rgba(255,255,255,0.55);
  outline-offset:2px;
}

/* =========================
   ✅ Start overlay ranking card（枠が消えたのを復活）
   GameRankingMini の見た目をカード化
========================= */

.gRankCard{
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.12);
  background:
    radial-gradient(700px 340px at 35% 0%,
      rgba(255,255,255,0.06),
      rgba(0,0,0,0) 65%),
    rgba(10, 13, 22, 0.55);
  box-shadow: var(--g-shadow2);
  overflow: hidden;
  min-width: 0;
}

.gRankHead{
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 10px;
  padding: 12px 12px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.10);
  min-width: 0;
}

.gRankTitle{
  font-weight: 950;
  font-size: 14px;
  color: rgba(255,255,255,0.92);
  letter-spacing: .02em;
  min-width: 0;
}

.gRankSub{
  font-weight: 900;
  font-size: 12px;
  color: rgba(255,255,255,0.55);
  min-width: 0;
  word-break: break-word;
  text-align: right;
}

.gRankInfo,
.gRankEmpty,
.gRankErr{
  padding: 12px;
  font-weight: 850;
  font-size: 12px;
  color: rgba(255,255,255,0.72);
}
.gRankErr{ color: rgba(255, 130, 130, 0.95); }

.gRankTableWrap{
  padding: 10px 12px 12px;
  overflow: hidden;
  min-width: 0;
}

.gRankTable{
  width: 100%;
  border-collapse: collapse;
  min-width: 0;
}

.gRankTable thead th{
  text-align: left;
  font-size: 12px;
  font-weight: 950;
  color: rgba(255,255,255,0.60);
  padding: 8px 6px;
  border-bottom: 1px solid rgba(255,255,255,0.10);
  white-space: nowrap;
}

.gRankTable tbody td{
  padding: 10px 6px;
  font-size: 13px;
  color: rgba(255,255,255,0.88);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  white-space: nowrap;
}

.gRankTable tbody tr:hover td{
  background: rgba(255,255,255,0.04);
}

.gRankNum{
  width: 28px;
  color: rgba(255,255,255,0.60);
  font-weight: 950;
}

.gRankName{
  max-width: 160px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.gRankScore{
  text-align: right;
  font-weight: 980;
  letter-spacing: .02em;
}

/* ✅ スマホはランキング見出しが折り返しても崩れない */
@media (max-width: 520px){
  .gRankHead{
    flex-wrap: wrap;
    align-items: flex-start;
  }
  .gRankSub{
    text-align: left;
  }
}

/* ===== Ranking mini card (Start overlay) ===== */
.gRankCard{
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.10);
  background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
  box-shadow: var(--g-shadow2);
  overflow: hidden;
  min-height: 220px;
}
.gRankHead{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  gap:10px;
  padding:12px 12px 10px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
.gRankTitle{
  font-weight: 950;
  letter-spacing: .02em;
  color: rgba(255,255,255,0.92);
  font-size: 13px;
}
.gRankSub{
  font-weight: 950;
  font-size: 12px;
  color: rgba(255,255,255,0.55);
}
.gRankTableWrap{ padding: 8px 10px 12px; overflow:hidden; }
.gRankTable{ width:100%; border-collapse:collapse; }
.gRankTable thead th{
  text-align:left;
  font-size:11px;
  font-weight:950;
  color: rgba(255,255,255,0.60);
  padding: 8px 6px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  white-space:nowrap;
}
.gRankTable tbody td{
  padding: 9px 6px;
  font-size: 12px;
  color: rgba(255,255,255,0.88);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  white-space:nowrap;
}
.gRankNum{ color: rgba(255,255,255,0.55); font-weight:950; width:26px; }
.gRankScore{ text-align:right; font-weight:980; letter-spacing:.02em; }

/* =========================
   Ranking mini card (start overlay)
========================= */

.gRankCard{
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.10);
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.07),
    rgba(255,255,255,0.03)
  );
  box-shadow: var(--g-shadow2);
  overflow: hidden;
  min-height: 220px;
  min-width: 0; /* ✅ はみ出し防止 */
}

.gRankHead{
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 10px;
  padding: 12px 12px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.gRankTitle{
  font-weight: 950;
  letter-spacing: 0.02em;
  color: rgba(255,255,255,0.92);
  font-size: 13px;
}

.gRankSub{
  font-weight: 950;
  font-size: 12px;
  color: rgba(255,255,255,0.55);
  white-space: nowrap;
}

.gRankInfo,
.gRankEmpty,
.gRankErr{
  padding: 12px;
  font-weight: 850;
  font-size: 12px;
  color: rgba(255,255,255,0.70);
}

.gRankErr{ color: rgba(255, 130, 130, 0.95); }

.gRankTableWrap{
  padding: 8px 10px 12px;
  overflow: hidden;
}

.gRankTable{
  width: 100%;
  border-collapse: collapse;
}

.gRankTable thead th{
  text-align: left;
  font-size: 11px;
  font-weight: 950;
  color: rgba(255,255,255,0.60);
  padding: 8px 6px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  white-space: nowrap;
}

.gRankTable tbody td{
  padding: 9px 6px;
  font-size: 12px;
  color: rgba(255,255,255,0.88);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  white-space: nowrap;
}

.gRankTable tbody tr:hover td{
  background: rgba(255,255,255,0.04);
}

.gRankNum{
  color: rgba(255,255,255,0.55);
  font-weight: 950;
  width: 26px;
}

.gRankName{
  max-width: 170px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.gRankScore{
  text-align: right;
  font-weight: 980;
  letter-spacing: 0.02em;
}

/* Mini ranking table frame (GameRankingMini内の表枠を復活) */
.gRankTableWrap{
  margin-top: 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  overflow: hidden;
}
.gRankTable{
  width: 100%;
  border-collapse: collapse;
}
.gRankTable thead th{
  border-bottom: 1px solid rgba(255,255,255,0.10);
}
.gRankTable tbody td{
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

/* HUDの各アイテムを“ピル”にして枠復活 */
.hudItem{
  opacity: .98;
  white-space: nowrap;
  min-width: 0;

  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.14);
}

.gRewardItemBtn{
  width: 100%;
  text-align: left;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.92);
  padding: 10px 12px;
  border-radius: 14px;
  cursor: pointer;
  font-weight: 900;
}
.gRewardItemBtn:hover{
  background: rgba(255,255,255,0.06);
  border-color: rgba(255,255,255,0.16);
}